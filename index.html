<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>VRC Text Chat</title>
    <script src="https://unpkg.com/wanakana"></script>
    <script
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="dist/vrIME.js?build=3"></script>
    <link rel="stylesheet" href="dist/style.css?build=3" />
  </head>
  <body>
    <div id="logs"></div>
    <div id="form">
      <!-- Gives an input to test without VRChat sending events. -->
      <div id="pointer"><span id="mode"></span>&gt;</div>
      <div id="input"><span id="output"></span><span id="suggestionAnchor"></span><span id="buffer"></span><input type="text" id="inputTrap"></div>
    </div>

    <!-- Sets up the actual bindings. -->
    <script type="text/javascript">
      document.getElementById('logs').innerHTML =
        'Failed to initialize scripts.<br>' +
        'TIME = ' + (new Date()).toISOString() + '<br>' +
        'wanakana = ' + (window.wanakana&&'Y'||'N') + '<br>' +
        'jQuery = ' + (window.jQuery&&'Y'||'N') + '<br>' +
        'vrIME = ' + (window.vrIME&&'Y'||'N') + '<br>' +
        'fetch = ' + (window.fetch&&'Y'||'N') + '<br>' +
        'URLSearchParams = ' + (window.URLSearchParams&&'Y'||'N') + '<br>' +
        'Promise = ' + (window.Promise&&'Y'||'N') + '<br>' +
        navigator.userAgent;
    </script>
    <script type="text/javascript">
      try {
        var toHiragana = function(input){
          return wanakana.toHiragana(input, {IMEMode: true});
        };
        window.key = vrIME.bindIME({
          log: '#logs',
          mode: '#mode',
          output: '#output',
          buffer: '#buffer',
          trap: '#inputTrap',
          suggestion: '#suggestionAnchor',
          toHiragana: toHiragana,
          jQuery: jQuery
        });
        window.text = function(str){
          for(var i = 0; i < str.length; i++){
            window.key(str[i]);
          }
        };
      } catch(e) {
        document.getElementById('logs').innerHTML = 'Error binding IME' + e.toString();
      }
    </script>
  </body>
</html>